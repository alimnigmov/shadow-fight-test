<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Shadow Fight Browser</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<style>
  body {
    margin: 0;
    background: #111;
    overflow: hidden;
    font-family: Arial, sans-serif;
    color: white;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }
  #game-container { position: relative; }

  canvas {
    background: #222;
    border: 2px solid #444;
    display: block;
  }

  /* –î–∂–æ–π—Å—Ç–∏–∫ */
  #joystick {
    position: absolute;
    bottom: 20px;
    left: 20px;
    width: 100px;
    height: 100px;
    background: rgba(255,255,255,0.2);
    border-radius: 50%;
    touch-action: none;
  }
  #stick {
    position: absolute;
    width: 40px;
    height: 40px;
    background: rgba(255,255,255,0.5);
    border-radius: 50%;
    top: 30px;
    left: 30px;
    touch-action: none;
  }

  /* –ö–Ω–æ–ø–∫–∏ —É–¥–∞—Ä–æ–≤ */
  .btn {
    position: absolute;
    bottom: 20px;
    width: 60px;
    height: 60px;
    border-radius: 50%;
    border: none;
    font-size: 24px;
    text-align: center;
    line-height: 60px;
    color: white;
    opacity: 0.8;
  }

  #punch { right: 100px; background: #5af; }
  #kick { right: 20px; background: #f55; }

</style>
</head>
<body>
<div id="game-container">
  <canvas id="game" width="640" height="360"></canvas>

  <div id="joystick"><div id="stick"></div></div>

  <button id="punch" class="btn">üëä</button>
  <button id="kick" class="btn">ü¶∂</button>
</div>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');

// –ò–≥—Ä–æ–∫
let player = {
  x: 100, y: 240, w: 40, h: 80, color: 'white',
  vx: 0, isPunching: false, isKicking: false
};

// –í—Ä–∞–≥
let enemy = {
  x: 500, y: 240, w: 40, h: 80, color: 'red',
  vx: 0, isPunching: false, isKicking: false
};

const speed = 3;

// –î–∂–æ–π—Å—Ç–∏–∫
const joystick = document.getElementById('joystick');
const stick = document.getElementById('stick');
let joyX = 0;
let joystickActive = false;

stick.addEventListener('touchstart', e => { joystickActive = true; });
stick.addEventListener('touchmove', e => {
  if(!joystickActive) return;
  let rect = joystick.getBoundingClientRect();
  let touch = e.touches[0];
  let dx = touch.clientX - rect.left - rect.width/2;
  let max = rect.width/2;
  if(dx > max) dx = max;
  if(dx < -max) dx = -max;
  joyX = dx / max * speed;
  stick.style.left = 30 + dx + 'px';
});
stick.addEventListener('touchend', e => { joystickActive = false; joyX = 0; stick.style.left = '30px'; });

// –ö–Ω–æ–ø–∫–∏ —É–¥–∞—Ä–æ–≤
document.getElementById('punch').addEventListener('touchstart', () => {
  player.isPunching = true;
  setTimeout(() => { player.isPunching = false; }, 300);
});
document.getElementById('kick').addEventListener('touchstart', () => {
  player.isKicking = true;
  setTimeout(() => { player.isKicking = false; }, 300);
});

// –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª
function update() {
  // –î–≤–∏–∂–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞
  player.x += joyX;
  if(player.x < 0) player.x = 0;
  if(player.x + player.w > canvas.width) player.x = canvas.width - player.w;

  // –î–≤–∏–∂–µ–Ω–∏–µ –≤—Ä–∞–≥–∞ (–ø—Ä–æ—Å—Ç–æ–π AI)
  if(enemy.x > player.x + 50) enemy.vx = -2;
  else if(enemy.x < player.x - 50) enemy.vx = 2;
  else enemy.vx = 0;

  enemy.x += enemy.vx;

  // –í—Ä–∞–≥ —Å–ª—É—á–∞–π–Ω–æ –∞—Ç–∞–∫—É–µ—Ç
  if(Math.random() < 0.01) enemy.isPunching = true;
  if(Math.random() < 0.01) enemy.isKicking = true;
  if(enemy.isPunching) setTimeout(()=>enemy.isPunching=false,300);
  if(enemy.isKicking) setTimeout(()=>enemy.isKicking=false,300);

  requestAnimationFrame(update);
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // –§–æ–Ω
  ctx.fillStyle = '#222';
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // –ò–≥—Ä–æ–∫
  ctx.fillStyle = player.color;
  ctx.fillRect(player.x, player.y, player.w, player.h);
  if(player.isPunching) ctx.fillStyle='#5af', ctx.fillRect(player.x+player.w, player.y+20, 30, 15);
  if(player.isKicking) ctx.fillStyle='#f55', ctx.fillRect(player.x+player.w, player.y+50, 30, 15);

  // –í—Ä–∞–≥
  ctx.fillStyle = enemy.color;
  ctx.fillRect(enemy.x, enemy.y, enemy.w, enemy.h);
  if(enemy.isPunching) ctx.fillStyle='#5af', ctx.fillRect(enemy.x-30, enemy.y+20, 30, 15);
  if(enemy.isKicking) ctx.fillStyle='#f55', ctx.fillRect(enemy.x-30, enemy.y+50, 30, 15);

  requestAnimationFrame(draw);
}

update();
draw();
</script>
</body>
</html>
